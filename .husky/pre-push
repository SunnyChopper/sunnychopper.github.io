#!/usr/bin/env sh

# Try to find npm in common locations
if command -v npm >/dev/null 2>&1; then
  NPM_CMD="npm"
elif [ -f "$HOME/.nvm/nvm.sh" ]; then
  . "$HOME/.nvm/nvm.sh"
  NPM_CMD="npm"
elif [ -f "$NVM_DIR/nvm.sh" ]; then
  . "$NVM_DIR/nvm.sh"
  NPM_CMD="npm"
else
  echo "npm not found. Skipping pre-push checks."
  exit 0
fi

# Run type-check (fail on errors)
$NPM_CMD run type-check || exit 1

# Run lint but only fail on actual errors, not warnings
# The import resolver has false positives, so we'll be lenient
$NPM_CMD run lint -- --max-warnings=1000 || echo "Lint warnings found (non-blocking)"

# Run format check
$NPM_CMD run format:check || exit 1
